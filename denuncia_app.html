<!doctype html><html lang="es"><head>  <meta charset="utf-8" />  <meta name="viewport" content="width=device-width,initial-scale=1" />  <title>Formulario de Denuncia Automática</title>  <style>    :root{      --bg:#f5f7fb; --card:#ffffff; --accent:#0b74ff; --muted:#666;    }    body{font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial; margin:0; background:var(--bg); color:#111;}    .wrap{max-width:980px;margin:18px auto;padding:18px;}    .card{background:var(--card);border-radius:10px;padding:18px;box-shadow:0 6px 20px rgba(0,0,0,0.06);}    header{display:flex;justify-content:space-between;align-items:center;gap:12px}    h1{font-size:18px;margin:0}    .subtitle{color:var(--muted);font-size:13px}    nav.tabs{display:flex;gap:6px;flex-wrap:wrap;margin:12px 0}    nav.tabs button{padding:8px 12px;border-radius:8px;border:1px solid #e2e8f0;background:#fff;cursor:pointer}    nav.tabs button.active{background:var(--accent);color:#fff;border-color:var(--accent)}    .pane{display:none;padding-top:8px}    .pane.active{display:block}    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}    .col{display:flex;flex-direction:column;gap:6px}    label{font-size:13px;color:#333}    input,select,textarea{padding:10px;border-radius:8px;border:1px solid #d7dce6;font-size:14px}    textarea{min-height:110px;resize:vertical}    .full{grid-column:1/-1}    .actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}    button.primary{background:var(--accent);color:#fff;padding:10px 14px;border-radius:8px;border:none;cursor:pointer}    button.ghost{background:transparent;padding:10px 14px;border-radius:8px;border:1px solid var(--accent);color:var(--accent);cursor:pointer}    .hint{font-size:13px;color:var(--muted)}    .hashtag{display:inline-block;background:#eef6ff;padding:8px;border-radius:8px;font-weight:700;margin-top:6px}    .objects-list{border:1px dashed #e2e8f0;padding:8px;border-radius:8px;max-height:220px;overflow:auto}    .obj-row{display:flex;gap:8px;align-items:center;margin-bottom:6px}    .obj-row input{flex:1}    .small{font-size:13px;color:var(--muted)}    .note{font-size:12px;color:#444;margin-top:8px}    footer{margin-top:12px;font-size:13px;color:var(--muted)}    @media(max-width:820px){.grid{grid-template-columns:1fr}.hashtag{display:block}}  </style>
  <!-- EmailJS cliente (para envío de correo sin backend). Configurar antes -->  <script src="https://cdn.emailjs.com/sdk/3.2.0/email.min.js"></script></head><body>  <div class="wrap">    <div class="card">      <header>        <div>          <h1>Formulario de Denuncia Automática</h1>          <div class="subtitle">Rellena paso a paso. Al finalizar se generará un JSON preparado para Prometeo.</div>        </div>        <div class="small">Versión prototipo</div>      </header>
      <nav class="tabs" id="tabs">        <button data-target="p1" class="active">1. Tipo</button>        <button data-target="p2">2. Denunciante</button>        <button data-target="p3">3. Hechos</button>        <button data-target="p4">4. Objetos</button>        <button data-target="p5">5. Narración</button>      </nav>
      <!-- PANE 1: TIPO DE DENUNCIA -->      <section id="p1" class="pane active">        <div class="grid">          <div class="col full">            <label for="tipo_denuncia">Seleccione el tipo de denuncia que desea realizar <span class="small">(obligatorio)</span></label>            <select id="tipo_denuncia" required>              <option value="">-- Seleccione una opción --</option>              <option value="perdida_extravio">Pérdida o extravío de documentos y/o efectos</option>              <option value="sustraccion_documentos">Sustracción de documentos y/o efectos</option>              <option value="recuperacion_documentos">Recuperación de documentos y/o efectos</option>              <option value="sustraccion_vehiculo">Sustracción de vehículo</option>              <option value="recuperacion_vehiculo">Recuperación de vehículo</option>              <option value="sustraccion_interior_vehiculo">Sustracción en interior de vehículo</option>              <option value="sustraccion_domicilio">Sustracción en domicilio y/o establecimiento</option>              <option value="robo_violencia">Robo con violencia o intimidación</option>              <option value="robo_fuerza_interior_domicilio">Robo con fuerza en interior de domicilio</option>            </select>            <div class="hint">Debes seleccionar el tipo antes de continuar.</div>          </div>        </div>
        <div class="actions">          <button class="ghost" onclick="prevTab()">Anterior</button>          <button class="primary" onclick="nextTab()">Siguiente</button>        </div>      </section>
      <!-- PANE 2: DENUNCIANTE -->      <section id="p2" class="pane">        <div class="grid">          <div class="col">            <label>Nombre <span class="small">(obligatorio)</span></label>            <input id="den_nombre" type="text" />          </div>          <div class="col">            <label>Apellidos <span class="small">(obligatorio)</span></label>            <input id="den_apellidos" type="text" />          </div>
          <div class="col">            <label>Documento de identificación</label>            <select id="den_doc_tipo">              <option value="">-- Selecciona tipo --</option>              <option value="dni">Documento Nacional de Identidad</option>              <option value="pasaporte">Pasaporte</option>              <option value="permiso_conducir">Permiso de Conducir</option>              <option value="se_desconoce">Se desconoce</option>              <option value="indocumentado">Indocumentado</option>              <option value="tarjeta_extranjera">Tarjeta identificación extranjera</option>            </select>          </div>          <div class="col">            <label>Número documento</label>            <input id="den_doc_num" type="text" />          </div>
          <div class="col">            <label>Teléfono</label>            <input id="den_telefono" type="tel" />          </div>          <div class="col">            <label>E-mail</label>            <input id="den_email" type="email" />          </div>
          <div class="col">            <label>Sexo</label>            <select id="den_sexo">              <option value="">-- Selecciona --</option>              <option>Masculino</option>              <option>Femenino</option>              <option>Otro / No especifica</option>            </select>          </div>          <div class="col">            <label>Fecha de nacimiento</label>            <input id="den_fecha_nac" type="date" />          </div>
          <div class="col">            <label>País de nacimiento</label>            <select id="pais_nacimiento"></select>          </div>          <div class="col">            <label>Provincia de nacimiento</label>            <select id="provincia_nacimiento"><option value="">-- Selecciona provincia --</option></select>          </div>
          <div class="col">            <label>Municipio de nacimiento</label>            <select id="municipio_nacimiento"><option value="">-- Selecciona municipio --</option></select>          </div>          <div class="col">            <label>Nacionalidad</label>            <select id="nacionalidad"></select>          </div>
          <div class="col full">            <label>País de domicilio</label>            <select id="pais_domicilio"></select>          </div>          <div class="col">            <label>Provincia de domicilio</label>            <select id="provincia_domicilio"><option value="">-- Selecciona provincia --</option></select>          </div>          <div class="col">            <label>Municipio de domicilio</label>            <select id="municipio_domicilio"><option value="">-- Selecciona municipio --</option></select>          </div>
          <div class="col full">            <label>Domicilio completo</label>            <input id="den_domicilio" type="text" placeholder="Calle, número, portal, piso..." />          </div>
          <div class="col full">            <label>Nombre de los padres (opcional)</label>            <input id="den_padres" type="text" />          </div>        </div>
        <div class="actions">          <button class="ghost" onclick="prevTab()">Anterior</button>          <button class="primary" onclick="nextTab()">Siguiente</button>        </div>      </section>
      <!-- PANE 3: HECHOS -->      <section id="p3" class="pane">        <div class="grid">          <div class="col">            <label>País del hecho</label>            <select id="pais_hecho"></select>          </div>          <div class="col">            <label>Provincia del hecho</label>            <select id="provincia_hecho"><option value="">-- Selecciona provincia --</option></select>          </div>          <div class="col">            <label>Municipio del hecho</label>            <select id="municipio_hecho"><option value="">-- Selecciona municipio --</option></select>          </div>
          <div class="col full">            <label>Localización del hecho (descripción corta)</label>            <input id="localizacion_hecho" type="text" placeholder="frente al nº..., interior del vehículo..." />          </div>
          <div class="col">            <label>Naturaleza del lugar</label>            <select id="naturaleza_lugar">              <option value="">-- Selecciona --</option>              <option>Espacios abiertos</option>              <option>Establecimientos</option>              <option>Instalaciones</option>              <option>Medios de transporte</option>              <option>Otras dependencias comunes</option>              <option>Recintos</option>              <option>Vías de comunicación</option>              <option>Viviendas</option>            </select>          </div>
          <div class="col">            <label>Tipo de vía</label>            <select id="tipo_via">              <option value="">-- Selecciona --</option>              <option>Autopista</option><option>Avenida</option><option>Barrio</option><option>Bloque</option>              <option>Calle</option><option>Callejón</option><option>Camino</option><option>Carretera</option>              <option>Colonia</option><option>Edificio</option><option>Finca</option><option>Glorieta</option>              <option>Pasaje</option><option>Paseo</option><option>Plaza</option><option>Poblado</option>              <option>Polígono</option><option>Travesía</option><option>Urbanización</option>            </select>          </div>
          <div class="col">            <label>Nombre de la vía</label>            <input id="nombre_via" type="text" />          </div>          <div class="col">            <label>Número</label>            <input id="numero_via" type="text" />          </div>
          <div class="col">            <label>Escalera / Piso</label>            <input id="escalera_piso" type="text" />          </div>          <div class="col">            <label>Resto dirección</label>            <input id="resto_direccion" type="text" />          </div>
          <div class="col">            <label>Fecha inicio del hecho</label>            <input id="fecha_inicio" type="date" />          </div>          <div class="col">            <label>Hora inicio del hecho</label>            <input id="hora_inicio" type="time" />          </div>
          <div class="col">            <label>Fecha fin del hecho (opcional)</label>            <input id="fecha_fin" type="date" />          </div>          <div class="col">            <label>Hora fin del hecho (opcional)</label>            <input id="hora_fin" type="time" />          </div>
          <div class="col full note">            Si conoce la fecha y hora exactas del hecho, no es necesario rellenar la fecha ni la hora de fin.          </div>        </div>
        <div class="actions">          <button class="ghost" onclick="prevTab()">Anterior</button>          <button class="primary" onclick="nextTab()">Siguiente</button>        </div>      </section>
      <!-- PANE 4: OBJETOS -->      <section id="p4" class="pane">        <div>          <label>Objetos relacionados (añadir manualmente)</label>          <div class="objects-list" id="objectsList">            <!-- filas dinámicas -->            <div class="small">No hay objetos añadidos.</div>          </div>          <div style="display:flex;gap:8px;margin-top:8px;">            <input id="obj_tipo" placeholder="Tipo de objeto (p.ej. móvil, cartera...)" />            <input id="obj_serial" placeholder="N.º serie / identificador (opcional)" />            <button class="ghost" onclick="addObject()">Añadir objeto</button>          </div>          <div class="note">Añade los objetos que sean relevantes. Se incluirán en el JSON final.</div>        </div>
        <div class="actions">          <button class="ghost" onclick="prevTab()">Anterior</button>          <button class="primary" onclick="nextTab()">Siguiente</button>        </div>      </section>
      <!-- PANE 5: NARRACIÓN (ChatGPT) -->      <section id="p5" class="pane">        <div class="grid">          <div class="col full">            <label>Narración del hecho (sin datos personales)</label>            <textarea id="narracion_text" placeholder="Aquí pegarás la narración redactada por ChatGPT (sin nombres ni datos identificativos)"></textarea>            <div class="hint">No incluyas nombres, DNIs, direcciones completas ni datos sensibles. Usa eufemismos: "la víctima", "el autor", etc.</div>          </div>
          <div class="col">            <label>Acciones con ChatGPT</label>            <div style="display:flex;gap:8px;">              <button class="ghost" onclick="openChatGPT()">Abrir ChatGPT</button>              <button class="ghost" onclick="copyToClipboard()">Copiar narración al portapapeles</button>            </div>            <div class="note">Al pulsar "Abrir ChatGPT" se abrirá una nueva pestaña y el contenido se copiará al portapapeles para pegar en la conversación con ChatGPT.</div>          </div>
          <div class="col">            <label>Dictado por voz (opcional)</label>            <div style="display:flex;gap:8px;">              <button class="ghost" id="startDict" onclick="toggleDictation()">Iniciar dictado</button>              <button class="ghost" onclick="stopDictation()">Detener dictado</button>            </div>            <div id="dictStatus" class="small">Dictado inactivo.</div>          </div>
          <div class="col full">            <div class="hint">Cuando tengas la narración generada por ChatGPT, pégala en el campo anterior. Se incluirá en el JSON final.</div>          </div>        </div>
        <div class="actions">          <button class="ghost" onclick="prevTab()">Anterior</button>          <button class="primary" onclick="generarHashtagYPreview()">Generar Hashtag</button>          <div style="margin-left:auto;display:flex;gap:8px">            <button class="ghost" onclick="downloadJSON()">Descargar JSON</button>            <button class="primary" onclick="sendByEmail()">Enviar por Gmail</button>          </div>        </div>      </section>
      <div style="margin-top:12px">        <div class="hashtag" id="hashtagPreview">No generado</div>        <div id="status" class="small" style="margin-top:8px"></div>      </div>
      <footer class="small">Flujo: Rellenar pestañas → Generar hashtag → Descargar JSON o Enviar por Gmail → En PC: descargar JSON desde Gmail y guardarlo en carpeta compartida para Prometeo.</footer>    </div>  </div>
<script>  /*******************************   * CONFIG - Ajusta estos valores   *******************************/  const EMAILJS_SERVICE_ID = 'TU_SERVICE_ID'; // p.ej. 'gmail'  const EMAILJS_TEMPLATE_ID = 'TU_TEMPLATE_ID'; // plantilla creada en EmailJS  const EMAILJS_PUBLIC_KEY = 'TU_PUBLIC_KEY'; // public key de EmailJS  const EMAIL_DESTINO = 'tu.correo@gmail.com'; // correo destino (tu Gmail)
  // Inicializa EmailJS  if (window.emailjs) {    emailjs.init(EMAILJS_PUBLIC_KEY);  }
  /*******************************   * UTIL: Pestañas   *******************************/  const tabs = document.querySelectorAll('nav.tabs button');  tabs.forEach(b => b.addEventListener('click', ()=>{ switchTab(b.dataset.target); }));  function switchTab(id) {    document.querySelectorAll('.pane').forEach(p=>p.classList.remove('active'));    document.getElementById(id).classList.add('active');    tabs.forEach(b=>b.classList.toggle('active', b.dataset.target===id));    window.scrollTo({top:0,behavior:'smooth'});  }  function nextTab(){    const visible = Array.from(document.querySelectorAll('.pane')).findIndex(p=>p.classList.contains('active'));    if (visible < document.querySelectorAll('.pane').length -1) {      const next = document.querySelectorAll('.pane')[visible+1].id;      // validación simple en primer paso: tipo denuncia obligatorio      if (document.querySelectorAll('.pane')[visible].id==='p1') {        const tipo = document.getElementById('tipo_denuncia').value;        if (!tipo) { alert('Selecciona el tipo de denuncia antes de continuar.'); return; }      }      switchTab(next);    }  }  function prevTab(){    const visible = Array.from(document.querySelectorAll('.pane')).findIndex(p=>p.classList.contains('active'));    if (visible > 0) {      const prev = document.querySelectorAll('.pane')[visible-1].id;      switchTab(prev);    }  }
  /*******************************   * Datos: países y provincias   *******************************/  // Lista de países (reducida para tamaño; puedes ampliar usando ISO)  const COUNTRIES = [    "España","Afganistán","Albania","Alemania","Andorra","Angola","Argentina","Australia","Austria","Bélgica",    "Bolivia","Brasil","Bulgaria","Canadá","Chile","China","Colombia","Corea del Sur","Costa Rica","Croacia",    "Cuba","Dinamarca","Ecuador","Egipto","El Salvador","Estados Unidos","Francia","Grecia","Guatemala","Honduras",    "Irlanda","Islandia","Italia","Japón","México","Marruecos","Noruega","Países Bajos","Perú","Polonia",    "Portugal","Reino Unido","Rumanía","Rusia","Sudáfrica","Suecia","Suiza","Turquía","Ucrania","Uruguay"  ];
  // Provincias de España (lista completa)  const PROVINCIAS_ES = [    "Álava","Albacete","Alicante","Almería","Asturias","Ávila","Badajoz","Barcelona","Burgos","Cáceres","Cádiz",    "Cantabria","Castellón","Ceuta","Ciudad Real","Córdoba","Cuenca","Gerona","Granada","Guadalajara","Guipúzcoa",    "Huelva","Huesca","Islas Baleares","Jaén","La Coruña","La Rioja","Las Palmas","León","Lérida","Lugo","Madrid",    "Málaga","Melilla","Murcia","Navarra","Orense","Palencia","Pontevedra","Salamanca","Santa Cruz de Tenerife","Segovia",    "Sevilla","Soria","Tarragona","Teruel","Toledo","Valencia","Valladolid","Vizcaya","Zamora","Zaragoza"  ];
  // Ejemplo de municipios por provincia (map reducido). Debes completar con tus datos o cargar desde un JSON.  const MUNICIPIOS_EJ = {    "Madrid": ["Madrid","Alcalá de Henares","Getafe","Leganés","Móstoles"],    "Barcelona": ["Barcelona","L'Hospitalet de Llobregat","Badalona","Sabadell","Terrassa"],    "Alicante": ["Alicante","Elche","Orihuela"],    "Sevilla": ["Sevilla","Dos Hermanas","Alcalá de Guadaíra"],    "La Coruña": ["A Coruña","Santiago de Compostela"],    // ... añade el resto según necesidad  };
  function llenarSelect(id, arr, placeholder){    const sel = document.getElementById(id);    sel.innerHTML = '';    if (placeholder) sel.innerHTML += `<option value="">${placeholder}</option>`;    arr.forEach(x => sel.innerHTML += `<option value="${x}">${x}</option>`);  }
  // llenar países y nacionalidad  ['pais_nacimiento','pais_domicilio','pais_hecho','pais'].forEach(()=>{});  llenarSelect('pais_nacimiento', COUNTRIES, '-- Selecciona país --');  llenarSelect('nacionalidad', COUNTRIES, '-- Selecciona nacionalidad --');  llenarSelect('pais_domicilio', COUNTRIES, '-- Selecciona país --');  llenarSelect('pais_hecho', COUNTRIES, '-- Selecciona país --');
  // llenar provincias  llenarSelect('provincia_nacimiento', PROVINCIAS_ES, '-- Selecciona provincia --');  llenarSelect('provincia_domicilio', PROVINCIAS_ES, '-- Selecciona provincia --');  llenarSelect('provincia_hecho', PROVINCIAS_ES, '-- Selecciona provincia --');
  // actualizar municipios al cambiar provincia (para demostración usa MUNICIPIOS_EJ)  function onProvinciaChange(provSelectId, muniSelectId) {    const prov = document.getElementById(provSelectId).value;    const muniSel = document.getElementById(muniSelectId);    muniSel.innerHTML = '<option value="">-- Selecciona municipio --</option>';    if (prov && MUNICIPIOS_EJ[prov]) {      MUNICIPIOS_EJ[prov].forEach(m => muniSel.innerHTML += `<option value="${m}">${m}</option>`);    } else {      // si no hay datos de municipios, dejamos campo vacío para edición manual futura      muniSel.innerHTML = '<option value="">-- No hay municipios cargados para esta provincia --</option>';    }  }  document.getElementById('provincia_nacimiento').addEventListener('change', ()=> onProvinciaChange('provincia_nacimiento','municipio_nacimiento'));  document.getElementById('provincia_domicilio').addEventListener('change', ()=> onProvinciaChange('provincia_domicilio','municipio_domicilio'));  document.getElementById('provincia_hecho').addEventListener('change', ()=> onProvinciaChange('provincia_hecho','municipio_hecho'));
  /*******************************   * Hashtag   *******************************/  function generarHashtag() {    const now = new Date();    const yyyy = now.getFullYear().toString();    const mm = (now.getMonth()+1).toString().padStart(2,'0');    const dd = now.getDate().toString().padStart(2,'0');    const hh = now.getHours().toString().padStart(2,'0');    const min = now.getMinutes().toString().padStart(2,'0');    const operador = (document.getElementById('den_nombre') && document.getElementById('den_nombre').value) ? (document.getElementById('den_nombre').value.split(' ')[0].substring(0,2).toUpperCase()) : 'XX';    return `#DN-${yyyy}${mm}${dd}-${hh}${min}-${operador}`;  }  function generarHashtagYPreview() {    const tag = generarHashtag();    document.getElementById('hashtagPreview').innerText = tag;    setStatus('Hashtag generado: ' + tag);    return tag;  }
  /*******************************   * Objetos - lista dinámica   *******************************/  let objetos = [];  function refreshObjects(){    const list = document.getElementById('objectsList');    list.innerHTML = '';    if (!objetos.length) { list.innerHTML = '<div class="small">No hay objetos añadidos.</div>'; return; }    objetos.forEach((o, idx) => {      const row = document.createElement('div');      row.className = 'obj-row';      row.innerHTML = `<input value="${o.tipo}" readonly /><input value="${o.serial||''}" readonly /><button class="ghost" onclick="removeObject(${idx})">Quitar</button>`;      list.appendChild(row);    });  }  function addObject(){    const tipo = document.getElementById('obj_tipo').value.trim();    const serial = document.getElementById('obj_serial').value.trim();    if (!tipo) { alert('Introduce el tipo de objeto'); return; }    objetos.push({tipo, serial});    document.getElementById('obj_tipo').value = '';    document.getElementById('obj_serial').value = '';    refreshObjects();  }  function removeObject(i){    objetos.splice(i,1); refreshObjects();  }
  /*******************************   * Construir JSON y descargar   *******************************/  function compilarJSON(){    // recoger datos de Denunciante    const denunciante = {      nombre: document.getElementById('den_nombre').value || '',      apellidos: document.getElementById('den_apellidos').value || '',      doc_tipo: document.getElementById('den_doc_tipo').value || '',      doc_num: document.getElementById('den_doc_num').value || '',      telefono: document.getElementById('den_telefono').value || '',      email: document.getElementById('den_email').value || '',      sexo: document.getElementById('den_sexo').value || '',      fecha_nacimiento: document.getElementById('den_fecha_nac').value || '',      pais_nacimiento: document.getElementById('pais_nacimiento').value || '',      provincia_nacimiento: document.getElementById('provincia_nacimiento').value || '',      municipio_nacimiento: document.getElementById('municipio_nacimiento').value || '',      nacionalidad: document.getElementById('nacionalidad').value || '',      pais_domicilio: document.getElementById('pais_domicilio').value || '',      provincia_domicilio: document.getElementById('provincia_domicilio').value || '',      municipio_domicilio: document.getElementById('municipio_domicilio').value || '',      domicilio: document.getElementById('den_domicilio').value || '',      padres: document.getElementById('den_padres').value || ''    };
    // hechos    const hechos = {      pais: document.getElementById('pais_hecho').value || '',      provincia: document.getElementById('provincia_hecho').value || '',      municipio: document.getElementById('municipio_hecho').value || '',      localizacion: document.getElementById('localizacion_hecho').value || '',      naturaleza_lugar: document.getElementById('naturaleza_lugar').value || '',      tipo_via: document.getElementById('tipo_via').value || '',      nombre_via: document.getElementById('nombre_via').value || '',      numero: document.getElementById('numero_via').value || '',      escalera_piso: document.getElementById('escalera_piso').value || '',      resto_direccion: document.getElementById('resto_direccion').value || '',      fecha_inicio: document.getElementById('fecha_inicio').value || '',      hora_inicio: document.getElementById('hora_inicio').value || '',      fecha_fin: document.getElementById('fecha_fin').value || '',      hora_fin: document.getElementById('hora_fin').value || ''    };
    const data = {      denuncia_id: generarHashtag(),      fecha_presentacion: new Date().toISOString().slice(0,10),      hora_presentacion: new Date().toTimeString().slice(0,5),      tipo_denuncia: document.getElementById('tipo_denuncia').value || '',      denunciante,      hechos,      objetos: objetos.slice(),      narracion_chatgpt: {        texto: document.getElementById('narracion_text').value || '',        fecha_redaccion: new Date().toISOString(),        fuente: "ChatGPT"      },      metadatos_app: {        app_version: "1.0-prototipo",        generado_en: new Date().toISOString()      }    };    return data;  }
  function downloadJSON(){    const data = compilarJSON();    const jsonStr = JSON.stringify(data, null, 2);    const filename = (data.denuncia_id || '#DENUNCIA') + '.json';    const blob = new Blob([jsonStr], {type:'application/json'});    const url = URL.createObjectURL(blob);    const a = document.createElement('a');    a.href = url; a.download = filename;    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);    setStatus('JSON descargado: ' + filename);  }
  /*******************************   * Envío por EmailJS   *******************************/  async function sendByEmail(){    const data = compilarJSON();    const jsonStr = JSON.stringify(data, null, 2);    const filename = (data.denuncia_id || '#DENUNCIA') + '.json';
    // convertimos a base64    function toBase64(str){ return btoa(unescape(encodeURIComponent(str))); }    const base64 = toBase64(jsonStr);    const dataUri = 'data:application/json;base64,' + base64;
    setStatus('Enviando correo...');
    if (!window.emailjs) {      alert('EmailJS no está inicializado. Revisa la configuración en el código.');      setStatus('EmailJS no disponible');      return;    }
    const templateParams = {      to_email: EMAIL_DESTINO,      subject: `Denuncia ${data.denuncia_id}`,      message: `Se adjunta JSON con la denuncia ${data.denuncia_id}`,      attachment: dataUri,      attachment_filename: filename    };
    try {      const resp = await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);      console.log('EmailJS resp', resp);      setStatus('Correo enviado correctamente a ' + EMAIL_DESTINO);      alert('Correo enviado correctamente. Comprueba tu Gmail en el PC y descarga el adjunto para guardarlo en la carpeta compartida.');    } catch (err) {      console.error(err);      setStatus('Error enviando correo: ' + (err && err.text ? err.text : err));      alert('Error enviando correo. Alternativa: Descargar JSON y enviarlo manualmente desde tu Gmail.');    }  }
  function setStatus(txt){ document.getElementById('status').innerText = txt; }
  /*******************************   * ChatGPT integration: copiar al portapapeles y abrir ChatGPT   *******************************/  async function copyToClipboard(){    const text = document.getElementById('narracion_text').value || '';    try {      await navigator.clipboard.writeText(text);      setStatus('Narración copiada al portapapeles.');    } catch(e){      setStatus('No se pudo copiar automáticamente. Selecciona y copia manualmente.');    }  }
  async function openChatGPT(){    // Copiar texto al portapapeles (si hay)    const txt = document.getElementById('narracion_text').value || '';    if (txt) {      try { await navigator.clipboard.writeText(txt); setStatus('Narración copiada. Abriendo ChatGPT...'); }      catch(e){ setStatus('No se pudo copiar automáticamente. Abriendo ChatGPT...'); }    } else {      setStatus('Abriendo ChatGPT para que inicies la narración (sin contenido pre-copiado).');    }    // Abrir chat.openai en nueva pestaña    window.open('https://chat.openai.com/', '_blank');  }
  /*******************************   * Dictado por voz (SpeechRecognition)   *******************************/  let recognition = null;  let recognizing = false;  function toggleDictation(){    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {      alert('Dictado por voz no disponible en este navegador.');      return;    }    if (recognizing) { stopDictation(); return; }    startDictation();  }
  function startDictation(){    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;    recognition = new SpeechRecognition();    recognition.lang = 'es-ES';    recognition.interimResults = true;    recognition.continuous = true;    recognition.onstart = ()=>{ recognizing = true; document.getElementById('startDict').innerText = 'Dictando...'; document.getElementById('dictStatus').innerText = 'Dictado activo.'; };    recognition.onerror = (e)=>{ console.log('SR error', e); };    recognition.onresult = (event)=>{      let interim = '';      let final = document.getElementById('narracion_text').value || '';      for (let i = event.resultIndex; i < event.results.length; ++i) {        if (event.results[i].isFinal) final += event.results[i][0].transcript + ' ';        else interim += event.results[i][0].transcript;      }      document.getElementById('narracion_text').value = final + interim;    };    recognition.onend = ()=>{ recognizing = false; document.getElementById('startDict').innerText = 'Iniciar dictado'; document.getElementById('dictStatus').innerText = 'Dictado inactivo.'; };    recognition.start();  }  function stopDictation(){ if (recognition) recognition.stop(); recognizing=false; document.getElementById('dictStatus').innerText='Dictado detenido.'; document.getElementById('startDict').innerText='Iniciar dictado'; }
  // inicializar estado  refreshObjects();  setStatus('Formulario listo. Empieza por "Tipo".');</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script type="text/javascript">
(function(){
    emailjs.init("oAsqE_pbf94u1kpqr"); // ← tu Public Key
})();

function enviarPorGmail() {
    const serviceID = "service_tn5oyno"; // ← tu Service ID
    const templateID = "template_7ji5f8y"; // ← tu Template ID

    const hashtag = document.querySelector("#hashtag").innerText;
    const jsonData = document.querySelector("#jsonOutput").innerText;

    const templateParams = {
        hashtag: hashtag,
        json_data: jsonData,
        to_email: "raulvazblanco@gmail.com" // ← tu correo destino
    };

    emailjs.send(serviceID, templateID, templateParams)
        .then(() => {
            alert(" Correo enviado correctamente. Revisa tu bandeja de entrada.");
        }, (err) => {
            console.error("Error:", err);
            alert(" Error enviando correo. Alternativa: Descargar JSON y enviarlo manualmente desde tu Gmail.");
        });
}
</script></body></html>